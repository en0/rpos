[<< Back](index.md)

## Notes on PIT

CLK frequency generated by the system oscillator is most likey 1.193182 MHz

Control Word format. (I/O port 0x43)

```
[ CS | CS | ACS | ACS | OM | OM | OM | BCD ]

CS : Counter Select
    0 0 : Channel 0 ***
    0 1 : Channel 1
    1 0 : Channel 2

ACS : Access Mode
    0 0 : Latch Count
    0 1 : LSB only
    1 0 : MSB only
    1 1 : LSB and MSB
    
OM : Operating Mode
    0 0 0 : Mode 0
    0 0 1 : Mode 1
    x 1 0 : Mode 2 ***
    x 1 1 : Mode 3
    1 0 0 : Mode 4
    1 0 1 : Mode 5

BCD : Binary Coded Decimal Enabled.
    0 : 16 bit words ***
    1 : for digit BCD
```

Formula to compute time between IRQs where RV is the Counter Value (in Hz)

- frequency = 1193182 / RV
- time in ms = RV / (3579545 / 3) * 1000

Using RV 0x04AA (1194) = 999.315 Hz = ~1 ms. Good enough for RPOS.

### COUNTER 0

This is the only counter connected to IRQs. It will implement the RTC (Mode 2)

- Counter 0 data port: 0x40
- Mode/Command  register: 0x43
- The BIOS ushually sets up Counter 0 to 18.2065 Hz (CR=65535)
- OUT 0 is connected to IRQ 0 via the PIC
- IRQs are generated on the rising edge of OUT 0

RTC implementation 

- Control Word: `0b00110100` (CS=0, ACS=3, OM=2, BCD=0)
- Reload Value: 0x04AA (CRl=0xAA, CRm=0x04)

```asm
; Setup RTC on Counter 0 to produce IRQ 0 at 1 ms intervals.
out $0b00110100, $0x43  ; CS=0, ACS=3, MODE=2, BCD=false
out $0xAA, $0x40        ; LSB of CR
out $0x04, $0x40        ; MSB of CR
```

### Counter 1 

NC and unusable (may not even exist in the system.)

### Counter 2 

connected directly to the PC Speaker

- Counter 2 data port: 0x42
- Mode/Command  register: 0x43
- GATE 2 is connected to IO port 0x61 (bit 0)
- OUT 2 is connected to IO port 0x61 (bit 5)
